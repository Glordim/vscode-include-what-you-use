# Include What You Use (IWYU) for VS Code

This extension integrates the **Include-What-You-Use (IWYU)** tool directly into VS Code to help you maintain clean and optimized inclusions in your C/C++ projects. It analyzes your source files and suggests headers to add or remove, reducing compilation times and unnecessary dependencies.

## Features

* **Automatic Analysis**: Uses your `compile_commands.json` to analyze the active file with the correct compilation flags.
* **Dry Run**: Runs IWYU and displays header suggestions in a dedicated Output channel without modifying your files.
* **Automatic Fix**: Directly applies header suggestions using the `fix_includes.py` script.
* **Clang-cl & PCH Support**: Intelligently handles MSVC-specific flags (Clang-cl) and Precompiled Headers (PCH) to prevent breaking your build.
* **Live Reload**: Monitors changes to your compilation database and reloads the cache automatically.

## Requirements

To function properly, this extension requires:

1.  **IWYU present on your system**: The `include-what-you-use` executable must be available (either built manually, portable, or installed).
2.  **Compilation Database**: A `compile_commands.json` file generated by CMake, Meson, or another build tool.
3.  **Python**: Required if you wish to use the "Fix" functionality via the `fix_includes.py` script.

## Extension Settings

This extension contributes the following settings through your `settings.json`:

### IWYU Core
* `iwyu.path`: Path to the `include-what-you-use` executable (Default: `include-what-you-use`).
* `iwyu.mappingFiles`: List of `.imp` mapping files to pass to IWYU.
* `iwyu.additionalArgs`: Additional arguments to pass to the IWYU tool.

### Compilation Database
* `iwyu.compileCommands.path`: Relative path to the folder containing `compile_commands.json` (e.g., `"build"`).

### Fix Includes
* `fixIncludes.path`: Path to the `fix_includes.py` script (Default: `fix_includes.py`).
* `fixIncludes.additionalArgs`: Extra arguments for the fix script (e.g., `["--nosafe_headers"]`).

## Usage

The extension provides two main commands via the Command Palette (`Ctrl+Shift+P`):

1.  **IWYU: Dry Run**: Analyzes the current file and prints the report to the "Include What You Use" Output channel.
2.  **IWYU: Fix Includes**: Analyzes the file, pipes the report to the Python script, and applies the changes to the disk.

## Technical Notes

* **PCH Handling**: The extension automatically detects `/Yu` or `/Yc` flags and adds the `--pch_in_code` argument to IWYU to ensure required precompiled header inclusions are preserved.
* **Driver Mode**: If `clang-cl` is detected as the compiler, the extension automatically sets the `--driver-mode=cl` flag.

---

## Release Notes

### 1.0.0

* Initial release.
* `compile_commands.json` support and file watching.
* `fix_includes.py` integration.
* Support for Clang-cl and PCH environments.

---

**Enjoy efficient header management!**